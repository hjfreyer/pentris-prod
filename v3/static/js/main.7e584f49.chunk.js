(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{41:function(e,t,n){e.exports=n(51)},47:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function a(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var i=n(0),o=n(21),c=n(38),u=n(57),l=n(56),s=n(55),p=n(23),f=n(35),h=n(53),d=n(58),v=n(7);n(47);function m(e){switch(e.kind){case"empty":return"cell empty";case"shape":return"cell color-".concat(e.shapeIdx)}}var g=function(e){return i.createElement("div",{className:"Board"},e.cells.map(function(e,t){return i.createElement("div",{className:"row",key:t},e.map(function(e,t){return i.createElement("div",{className:m(e),key:t})}))}))},y=n(5),b=n(13),w=n(14),k=n(18),E=n(20);function O(e){return e.map(function(e){var t=Object(y.a)(e,2);return[t[0],-t[1]]})}var S=[[0,0],[1,0],[0,1],[0,2],[-1,1]],N=[[0,0],[0,1],[0,2],[0,3],[1,3]],j=[[1,0],[1,1],[0,1],[0,2],[0,3]],D=[[0,0],[1,0],[0,1],[1,1],[1,-1]],x=[[0,0],[0,1],[0,2],[0,3],[-1,1]],T=[[0,0],[0,1],[0,2],[-1,0],[1,2]],M=[S,O(S),N,O(N),j,O(j),D,O(D),x,O(x),T,O(T),[[0,-1],[0,1],[0,0],[1,0],[2,0]],[[0,0],[0,-1],[0,1],[-1,1],[-1,-1]],[[0,-2],[0,-1],[0,0],[1,0],[2,0]],[[0,0],[0,1],[1,1],[1,2],[2,2]],[[0,0],[-1,0],[1,0],[0,-1],[0,1]],[[0,0],[0,1],[0,2],[0,3],[0,4]]],L=[[0,0],[0,1],[0,2],[1,2]],I=O(L),A=[[1,0],[1,1],[0,1],[0,2]],C=O(A),P=[[[0,0]],[[0,0],[0,1]]].concat([[[0,0],[0,1],[0,2]],[[0,0],[0,1],[1,1]]],[[[0,0],[0,1],[0,2],[0,3]],L,I,[[0,0],[0,1],[1,0],[1,1]],A,C,[[0,0],[0,1],[0,2],[1,1]]],M),G=P.length;function R(e){var t=P[e.idx];return t=function(e,t){var n=function(e){var t=_(e),n=Object(y.a)(t,4),r=n[0],a=n[1],i=n[2],o=n[3]-a,c=Math.ceil((o-(i-r))/2);return[r-c+o/2,a+o/2]}(e),r=Object(y.a)(n,2),a=r[0],i=r[1],o=e;o=F(o,-a,-i);for(var c=0;c<t;c++)o=o.map(function(e){var t=Object(y.a)(e,2),n=t[0],r=t[1];return[r,-n]});return F(o,a,i)}(t,e.rot),t=F(t,e.row,e.col)}function W(e,t){var n=_(P[e]),r=Object(y.a)(n,4),a=r[1],i=r[2],o=r[3];return{idx:e,row:-i,col:Math.floor((t-o+a)/2)-a,rot:0}}function F(e,t,n){return e.map(function(e){var r=Object(y.a)(e,2),a=r[0],i=r[1];return[a+t,i+n]})}function _(e){var t=e.map(function(e){var t=Object(y.a)(e,2),n=t[0];t[1];return n}),n=e.map(function(e){var t=Object(y.a)(e,2);t[0];return t[1]});return[Math.min.apply(Math,Object(E.a)(t)),Math.min.apply(Math,Object(E.a)(n)),Math.max.apply(Math,Object(E.a)(t)),Math.max.apply(Math,Object(E.a)(n))]}var B=function(){function e(t){Object(b.a)(this,e),this.levelTable=void 0,this.levelTable=t}return Object(w.a)(e,[{key:"getLevel",value:function(e){return Math.min(Math.floor(e.lines/10),this.levelTable.length-1)}},{key:"getSpeed",value:function(e){return Math.min(Math.max(e.minLevel,this.getLevel(e)),this.levelTable.length-1)}},{key:"getGravity",value:function(e){return this.levelTable[this.getSpeed(e)].gravity}},{key:"getMultiplier",value:function(e){return this.levelTable[this.getSpeed(e)].multiplier}}]),e}(),H=function(){function e(t,n){Object(b.a)(this,e),this.rand=void 0,this.levelTable=void 0,this.rand=t,this.levelTable=n}return Object(w.a)(e,[{key:"view",value:function(){return new B(this.levelTable)}},{key:"newState",value:function(e){return{width:12,height:24,nextShapeIdx:this.rand.nextShape(),activeShape:W(this.rand.nextShape(),12),dasDirection:"NONE",dasDelay:0,softDrop:!1,entryDelay:18,gravity:this.levelTable[e.minLevel].gravity,board:J(12,24),score:0,lines:0,minLevel:e.minLevel,toppedOut:!1}}},{key:"tick",value:function(e){var t=this;return e.toppedOut?e:Object(k.a)(e,function(e){t.doDAS(e),t.doEntry(e)&&(t.doGravity(e)||t.doLockDown(e))})}},{key:"input",value:function(e,t){var n=this;return e.toppedOut?e:Object(k.a)(e,function(e){switch(t.left?("NONE"===e.dasDirection&&($(e,0,-1,0),e.dasDelay=16),e.dasDirection="LEFT"):t.right?("NONE"===e.dasDirection&&($(e,0,1,0),e.dasDelay=16),e.dasDirection="RIGHT"):e.dasDirection="NONE",e.softDrop=t.down,t.action){case"NONE":break;case"SPIN":$(e,0,0,1);break;case"DROP":n.doDrop(e)}})}},{key:"doEntry",value:function(e){return!(0<e.entryDelay)||(e.entryDelay--,!1)}},{key:"doDAS",value:function(e){"NONE"!==e.dasDirection&&(0===e.dasDelay?(e.dasDelay=6,$(e,0,"LEFT"===e.dasDirection?-1:1,0)):e.dasDelay--)}},{key:"doGravity",value:function(e){return 0<e.gravity?(e.gravity-=e.softDrop?5:1,!0):(e.gravity=this.view().getGravity(e),$(e,1,0,0))}},{key:"doDrop",value:function(e){for(;$(e,1,0,0););this.doLockDown(e)}},{key:"doLockDown",value:function(e){e.board=U(e),e.entryDelay=18,e.activeShape=W(e.nextShapeIdx,e.width),e.nextShapeIdx=this.rand.nextShape();for(var t=[],n=function(n){(function(){for(var t=0;t<e.width;t++)if("empty"===e.board[n][t].kind)return!1;return!0})()&&t.push(n)},r=0;r<e.height;r++)n(r);for(var a=J(e.width,e.height),i=e.height-1,o=e.height-1;i>=0;)if(t.includes(i))i--;else{for(var c=0;c<e.width;c++)a[o][c]=e.board[i][c];i--,o--}e.board=a,e.score+=this.view().getMultiplier(e)*(Math.pow(2,t.length)-1),e.lines+=t.length,e.toppedOut=Q(e,e.activeShape)}}]),e}();function J(e,t){for(var n=[],r=0;r<t;r++)n.push(Array(e).fill({kind:"empty"}));return n}function U(e){var t=e.board.map(function(e){return e.slice()}),n=!0,r=!1,a=void 0;try{for(var i,o=R(e.activeShape)[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var c=i.value,u=Object(y.a)(c,2),l=u[0],s=u[1];l<0||(t[l][s]={kind:"shape",shapeIdx:e.activeShape.idx})}}catch(p){r=!0,a=p}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}function Q(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=function(){var t=i.value,n=(u=Object(y.a)(t,2))[0],r=u[1];if(e.height<=n||r<0||e.width<=r||!(n<0)&&"empty"!==e.board[n][r].kind)return{v:!0}},c=R(t)[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var u,l=o();if("object"===typeof l)return l.v}}catch(s){r=!0,a=s}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}return!1}function $(e,t,n,r){var a={idx:e.activeShape.idx,row:e.activeShape.row+t,col:e.activeShape.col+n,rot:(e.activeShape.rot+r)%4};return!Q(e,a)&&(e.activeShape=a,!0)}var q=function(e){var t=e.shapeIdx,n=function(e){var t=P[e],n=_(t),r=Object(y.a)(n,4),a=r[0],i=r[1],o=r[2],c=r[3];return[F(t,-a,-i),o-a+1,c-i+1]}(t),r=Object(y.a)(n,3),a=r[0],o=r[1],c=r[2],u=Array.from({length:o},function(){return Array(c).fill({kind:"empty"})}),l=!0,s=!1,p=void 0;try{for(var f,h=a[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var d=f.value,v=Object(y.a)(d,2),m=v[0],b=v[1];u[m][b]={kind:"shape",shapeIdx:t}}}catch(w){s=!0,p=w}finally{try{l||null==h.return||h.return()}finally{if(s)throw p}}return i.createElement("div",{className:"PiecePreview"},i.createElement(g,{cells:u}))};n(49);var z=function(e){var t=e.state,n=e.view,r=e.dispatch,a=function(e){return r({kind:"update-prefs",update:function(t){return Object(v.a)({},t,{startingSpeed:e.target.valueAsNumber})}})};switch(t.kind){case"new_game":return i.createElement("div",{className:"App"},i.createElement("div",{className:"new-game"},i.createElement("h1",null,"Pentris!"),i.createElement("p",null,"v3beta: Now with Levels!!"),i.createElement("div",{className:"form-row"},i.createElement("label",null,"Starting Speed"),i.createElement("input",{type:"range",min:"1",max:"30",value:t.prefs.startingSpeed,onChange:a}),i.createElement("input",{type:"number",min:"1",max:"30",value:t.prefs.startingSpeed,onChange:a})),i.createElement("button",{className:"btn btn-primary",autoFocus:!0,onClick:function(){return r({kind:"ui",action:"START"})}},"New Game")));case"in_game":var o=t.game;return i.createElement("div",{className:"App"},i.createElement("main",null,i.createElement(g,{cells:U(o)})),i.createElement("aside",null,i.createElement("h1",null,"Pentris"),i.createElement("p",{className:"copy"},"It's Beta.",i.createElement("br",null),"It's Delicious.",i.createElement("br",null),"It's Pentris."),i.createElement("h2",null,"Preview"),i.createElement(q,{shapeIdx:o.nextShapeIdx}),i.createElement("h3",null,"Score"),i.createElement("h3",null,"Lines Cleared"),i.createElement("p",{className:"score"},o.score),i.createElement("p",{className:"score"},o.lines),i.createElement("h3",null,"Level"),i.createElement("h3",null,"Speed"),i.createElement("p",{className:"score"},n.getLevel(o)+1),i.createElement("p",{className:"score"},n.getMultiplier(o))),i.createElement("div",{className:"game-over",hidden:!o.toppedOut},i.createElement("div",{className:"card"},i.createElement("h1",null,"OWNED!"),i.createElement("p",null,"Score: ",o.score),i.createElement("button",{className:"btn btn-primary",onClick:function(){return r({kind:"ui",action:"START"})}},"New Game"))))}},K=n(52),V=n(60),X=n(34),Y=n(59),Z=n(54);var ee=n(37),te=function(){function e(t,n){Object(b.a)(this,e),this.rand=void 0,this.n=void 0,this.bag=void 0,this.rand=t,this.n=n,this.bag=[]}return Object(w.a)(e,[{key:"nextShape",value:function(){return 0===this.bag.length&&(this.bag=Array.from({length:this.n*G},function(e,t){return t%G}),function(e,t){for(var n=e.length-1;n>0;n--){var r=Math.floor(t.next()*(n+1)),a=[e[r],e[n]];e[n]=a[0],e[r]=a[1]}}(this.bag,this.rand)),this.bag.pop()}}]),e}();function ne(e){return Math.floor(48*Math.pow(.9,e))}var re=function(){function e(t){Object(b.a)(this,e),this.gameController=void 0,this.gameController=t}return Object(w.a)(e,[{key:"initialState",value:function(e){return void 0===e&&(e={startingSpeed:1}),{kind:"new_game",prefs:e}}},{key:"apply",value:function(e,t){switch(t.kind){case"tick":return this.tick(e);case"input":return this.input(e,t.input);case"ui":return this.start(e);case"update-prefs":return this.updatePrefs(e,t)}}},{key:"start",value:function(e){return{kind:"in_game",prefs:e.prefs,game:this.gameController.newState({minLevel:e.prefs.startingSpeed-1})}}},{key:"tick",value:function(e){var t=this;return Object(k.a)(e,function(e){"in_game"===e.kind&&(e.game=t.gameController.tick(e.game))})}},{key:"input",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var n=this;return Object(k.a)(e,function(e){"in_game"===e.kind&&(e.game=n.gameController.input(e.game,t))})})},{key:"updatePrefs",value:function(e,t){return Object(v.a)({},e,{prefs:t.update(e.prefs)})}}]),e}(),ae="prefs";function ie(e){switch(e){case"ArrowLeft":return"LEFT";case"ArrowRight":return"RIGHT";case"ArrowDown":return"DOWN";case"ArrowUp":return"SPIN";case" ":return"DROP";default:return null}}function oe(){return i.createElement("div",{id:"shape-tests"},i.createElement("h1",null,"Shape Tests"),Array.from({length:G},function(e,t){return i.createElement("div",{className:"shape"},i.createElement(q,{shapeIdx:t}))}))}var ce=function(){var e=document.getElementById("root");o.render(i.createElement(oe,null),e)};n(50);"/shape-test"===window.location.pathname?ce():function(){var e=new c.a,t=u.a(0,1e3/60).pipe(p.a(function(e){return{kind:"tick"}})),n=l.a(document,"keydown"),r=l.a(document,"keyup"),a=function(e){var t=e.pipe(K.a(function(e){return e.button}),p.a(function(e){return e.pipe(V.a("pressed"))}),X.a()),n=Y.a(function(e){return"LEFT"===e.button||"RIGHT"===e.button||"DOWN"===e.button})(t),r=Object(y.a)(n,2),a=r[0],i=r[1],o={left:!1,right:!1,down:!1,action:"NONE"},c=a.pipe(h.a(function(e,t){return"DOWN"===t.button?Object(v.a)({},e,{down:t.pressed}):"LEFT"===t.button?t.pressed?Object(v.a)({},e,{left:!0,right:!1}):Object(v.a)({},e,{left:!1}):"RIGHT"===t.button?t.pressed?Object(v.a)({},e,{left:!1,right:!0}):Object(v.a)({},e,{right:!1}):e},o),d.a(o)),u=i.pipe(f.a(function(e){return e.pressed}),p.a(function(e){return e.button})),l=c.pipe(p.a(function(e){return Object(v.a)({},e,{action:"NONE"})})),m=u.pipe(Z.a(c),p.a(function(e){var t=Object(y.a)(e,2),n=t[0],r=t[1];return Object(v.a)({},r,{action:n})}));return s.a(l,m)}(s.a(r,n).pipe(p.a(function(e){return{button:ie(e.key),pressed:"keydown"===e.type}}),f.a(function(e){return null!=e.button}))).pipe(p.a(function(e){return{kind:"input",input:e}})),m=s.a(e,a,t),g=function(){var e=Array.from({length:37},function(e,t){return{number:t+1,gravity:ne(t),multiplier:(n=ne(t),Math.abs(Math.floor(Math.log(n/48)/Math.log(.9)))+1)};var n});return new H(new te(new ee.a,2),e)}(),b=new re(g),w={startingSpeed:1};ae in localStorage&&(w=JSON.parse(localStorage[ae]));var k=b.initialState(w),E=m.pipe(h.a(function(e,t){var n=b.apply(e,t);return function(e,t){"update-prefs"===t.kind&&(localStorage[ae]=JSON.stringify(e.prefs))}(n,t),n},k),d.a(k)).pipe(p.a(function(t){return i.createElement(z,{key:"app",state:t,view:g.view(),dispatch:function(t){return e.next(t)}})})),O=document.getElementById("root");E.subscribe(function(e){return o.render(e,O)})}(),function(){if("serviceWorker"in navigator){if(new URL("/v3",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/v3","/service-worker.js");r?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):a(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):a(e)})}}()}},[[41,1,2]]]);
//# sourceMappingURL=main.7e584f49.chunk.js.map