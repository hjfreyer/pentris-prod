(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{41:function(e,t,n){e.exports=n(51)},47:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function a(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var i=n(37),o=n(0),c=n(21),u=n(38),l=n(57),s=n(56),h=n(55),d=n(23),f=n(35),p=n(53),v=n(58);n(47);function m(e){switch(e.kind){case"empty":return"cell empty";case"shape":return"cell color-".concat(e.shapeIdx)}}var b=function(e){return o.createElement("div",{className:"Board"},e.cells.map(function(e,t){return o.createElement("div",{className:"row",key:t},e.map(function(e,t){return o.createElement("div",{className:m(e),key:t})}))}))},g=n(3),w=n(12),y=n(13),O=n(18),k=n(20);function E(e){return e.map(function(e){var t=Object(g.a)(e,2);return[t[0],-t[1]]})}function j(e){var t=e.map(function(e){var t=Object(g.a)(e,2),n=t[0];t[1];return n}),n=e.map(function(e){var t=Object(g.a)(e,2);t[0];return t[1]});return[Math.min.apply(Math,Object(k.a)(t)),Math.min.apply(Math,Object(k.a)(n)),Math.max.apply(Math,Object(k.a)(t)),Math.max.apply(Math,Object(k.a)(n))]}function N(e,t){var n=j(e),r=Object(g.a)(n,4),a=r[1],i=r[2],o=r[3];return[-i,Math.floor((t-o+a)/2)-a]}function S(e,t){for(var n=function(e){var t=j(e),n=Object(g.a)(t,4),r=n[0],a=n[1],i=n[2],o=n[3]-a;return[r-Math.ceil((o-(i-r))/2)+o/2,a+o/2]}(e),r=Object(g.a)(n,2),a=r[0],i=r[1],o=e.map(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return[n-a,r-i]}),c=0;c<t;c++)o=o.map(function(e){var t=Object(g.a)(e,2),n=t[0];return[t[1],-n]});return o.map(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return[n+a,r+i]})}var D=[[0,0],[1,0],[0,1],[0,2],[-1,1]],x=[[0,0],[0,1],[0,2],[0,3],[1,3]],I=[[1,0],[1,1],[0,1],[0,2],[0,3]],T=[[0,0],[1,0],[0,1],[1,1],[1,-1]],L=[[0,0],[0,1],[0,2],[0,3],[-1,1]],M=[[0,0],[0,1],[0,2],[-1,0],[1,2]],A=[D,E(D),x,E(x),I,E(I),T,E(T),L,E(L),M,E(M),[[0,-1],[0,1],[0,0],[1,0],[2,0]],[[0,0],[0,-1],[0,1],[-1,1],[-1,-1]],[[0,-2],[0,-1],[0,0],[1,0],[2,0]],[[0,0],[0,1],[1,1],[1,2],[2,2]],[[0,0],[-1,0],[1,0],[0,-1],[0,1]],[[0,0],[0,1],[0,2],[0,3],[0,4]]],R=[[0,0],[0,1],[0,2],[1,2]],C=E(R),P=[[1,0],[1,1],[0,1],[0,2]],W=E(P),G=[[[0,0]],[[0,0],[0,1]]].concat([[[0,0],[0,1],[0,2]],[[0,0],[0,1],[1,1]]],[[[0,0],[0,1],[0,2],[0,3]],R,C,[[0,0],[0,1],[1,0],[1,1]],P,W,[[0,0],[0,1],[0,2],[1,1]]],A),F=function(){function e(t){Object(w.a)(this,e),this.levelTable=void 0,this.levelTable=t}return Object(y.a)(e,[{key:"startingLevel",value:function(){return this.levelTable[0]}},{key:"getLevelInfo",value:function(e){var t=Math.floor(e.lines/10);return this.levelTable[t<this.levelTable.length?t:this.levelTable.length-1]}}]),e}(),_=function(){function e(t,n){Object(w.a)(this,e),this.rand=void 0,this.view=void 0,this.rand=t,this.view=n}return Object(y.a)(e,[{key:"newState",value:function(){var e=this.rand.nextShape(),t=N(G[e],12),n=Object(g.a)(t,2),r=n[0],a=n[1];return{width:12,height:24,nextShapeIdx:this.rand.nextShape(),activeShape:{shapeIdx:e,dRow:r,dCol:a,rotation:0},dasDirection:"NONE",dasDelay:0,softDrop:!1,entryDelay:18,gravity:this.view.startingLevel().gravity,board:B(12,24),score:0,lines:0,toppedOut:!1}}},{key:"tick",value:function(e){var t=this;return e.toppedOut?e:Object(O.a)(e,function(e){t.doDAS(e),t.doEntry(e)&&(t.doGravity(e)||t.doLockDown(e))})}},{key:"input",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var n=this;return e.toppedOut?e:Object(O.a)(e,function(e){switch(t.left?("NONE"===e.dasDirection&&(V(e,0,-1,0),e.dasDelay=16),e.dasDirection="LEFT"):t.right?("NONE"===e.dasDirection&&(V(e,0,1,0),e.dasDelay=16),e.dasDirection="RIGHT"):e.dasDirection="NONE",e.softDrop=t.down,t.action){case"NONE":break;case"SPIN":Q(e,t.action);break;case"DROP":n.doDrop(e)}})})},{key:"doEntry",value:function(e){return!(0<e.entryDelay)||(e.entryDelay--,!1)}},{key:"doDAS",value:function(e){"NONE"!==e.dasDirection&&(0===e.dasDelay?(e.dasDelay=6,Q(e,e.dasDirection)):e.dasDelay--)}},{key:"doGravity",value:function(e){return 0<e.gravity?(e.gravity-=e.softDrop?5:1,!0):(e.gravity=this.view.getLevelInfo(e).gravity,V(e,1,0,0))}},{key:"doDrop",value:function(e){for(;V(e,1,0,0););this.doLockDown(e)}},{key:"doLockDown",value:function(e){e.board=J(e),e.entryDelay=18;var t=N(G[e.nextShapeIdx],e.width),n=Object(g.a)(t,2),r=n[0],a=n[1];e.activeShape={shapeIdx:e.nextShapeIdx,dRow:r,dCol:a,rotation:0},e.nextShapeIdx=this.rand.nextShape();for(var i=[],o=function(t){(function(){for(var n=0;n<e.width;n++)if("empty"===e.board[t][n].kind)return!1;return!0})()&&i.push(t)},c=0;c<e.height;c++)o(c);for(var u=B(e.width,e.height),l=e.height-1,s=e.height-1;l>=0;)if(i.includes(l))l--;else{for(var h=0;h<e.width;h++)u[s][h]=e.board[l][h];l--,s--}e.board=u,e.score+=this.view.getLevelInfo(e).multiplier*(Math.pow(2,i.length)-1),e.lines+=i.length,e.toppedOut=U(e,e.activeShape)}}]),e}();function B(e,t){for(var n=[],r=0;r<t;r++)n.push(Array(e).fill({kind:"empty"}));return n}function H(e){var t=G[e.shapeIdx];return(t=(t=S(t,e.rotation)).map(function(t){var n=Object(g.a)(t,2),r=n[0],a=n[1];return[r+e.dRow,a+e.dCol]})).filter(function(e){var t=Object(g.a)(e,2),n=t[0];t[1];return n>=0})}function J(e){var t=e.board.map(function(e){return e.slice()}),n=H(e.activeShape),r=!0,a=!1,i=void 0;try{for(var o,c=n[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value,l=Object(g.a)(u,2),s=l[0],h=l[1];t[s][h]={kind:"shape",shapeIdx:e.activeShape.shapeIdx}}}catch(d){a=!0,i=d}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return t}function U(e,t){var n=H(t),r=!0,a=!1,i=void 0;try{for(var o,c=function(){var t=o.value,n=(l=Object(g.a)(t,2))[0],r=l[1];if(e.height<=n||r<0||e.width<=r||!(n<0)&&"empty"!==e.board[n][r].kind)return{v:!0}},u=n[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var l,s=c();if("object"===typeof s)return s.v}}catch(h){a=!0,i=h}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return!1}function V(e,t,n,r){var a={shapeIdx:e.activeShape.shapeIdx,dRow:e.activeShape.dRow+t,dCol:e.activeShape.dCol+n,rotation:(e.activeShape.rotation+r)%4};return!U(e,a)&&(e.activeShape=a,!0)}function Q(e,t){switch(t){case"LEFT":return V(e,0,-1,0);case"DOWN":return V(e,1,0,0);case"RIGHT":return V(e,0,1,0);case"SPIN":return V(e,0,0,1)}}var $=function(e){var t=e.shapeIdx,n=function(e){var t=j(e),n=Object(g.a)(t,4),r=n[0],a=n[1],i=n[2],o=n[3];return[e.map(function(e){var t=Object(g.a)(e,2),n=t[0],i=t[1];return[n-r,i-a]}),i-r+1,o-a+1]}(G[t]),r=Object(g.a)(n,3),a=r[0],i=r[1],c=r[2],u=Array.from({length:i},function(){return Array(c).fill({kind:"empty"})}),l=!0,s=!1,h=void 0;try{for(var d,f=a[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var p=d.value,v=Object(g.a)(p,2),m=v[0],w=v[1];u[m][w]={kind:"shape",shapeIdx:t}}}catch(y){s=!0,h=y}finally{try{l||null==f.return||f.return()}finally{if(s)throw h}}return o.createElement("div",{className:"PiecePreview"},o.createElement(b,{cells:u}))};n(49);var q=function(e){var t=e.state,n=e.view,r=e.dispatch;switch(t.kind){case"new_game":return o.createElement("div",{className:"App"},o.createElement("div",{className:"new-game"},o.createElement("h1",null,"Pentris!"),o.createElement("p",null,"v3beta: Now with Levels!!"),o.createElement("button",{className:"btn btn-primary",autoFocus:!0,onClick:function(){return r({kind:"ui",action:"START"})}},"New Game")));case"in_game":var a=t.game;return o.createElement("div",{className:"App"},o.createElement("main",null,o.createElement(b,{cells:J(a)})),o.createElement("aside",null,o.createElement("h1",null,"Pentris"),o.createElement("p",{className:"copy"},"It's Beta.",o.createElement("br",null),"It's Delicious.",o.createElement("br",null),"It's Pentris."),o.createElement("h2",null,"Preview"),o.createElement($,{shapeIdx:a.nextShapeIdx}),o.createElement("h3",null,"Score"),o.createElement("h3",null,"Lines Cleared"),o.createElement("p",{className:"score"},a.score),o.createElement("p",{className:"score"},a.lines),o.createElement("h3",null,"Level"),o.createElement("h3",null,"Speed"),o.createElement("p",{className:"score"},n.getLevelInfo(a).number),o.createElement("p",{className:"score"},n.getLevelInfo(a).multiplier)),o.createElement("div",{className:"game-over",hidden:!a.toppedOut},o.createElement("div",{className:"card"},o.createElement("h1",null,"OWNED!"),o.createElement("p",null,"Score: ",a.score),o.createElement("button",{className:"btn btn-primary",onClick:function(){return r({kind:"ui",action:"START"})}},"New Game"))))}},z=n(14),K=n(52),X=n(60),Y=n(34),Z=n(59),ee=n(54);var te=function(){function e(t,n){Object(w.a)(this,e),this.rand=void 0,this.n=void 0,this.bag=void 0,this.rand=t,this.n=n,this.bag=[]}return Object(y.a)(e,[{key:"nextShape",value:function(){return 0===this.bag.length&&(this.bag=Array.from({length:this.n*G.length},function(e,t){return t%G.length}),function(e,t){for(var n=e.length-1;n>0;n--){var r=Math.floor(t.next()*(n+1)),a=[e[r],e[n]];e[n]=a[0],e[r]=a[1]}}(this.bag,this.rand)),this.bag.pop()}}]),e}();var ne=function(){function e(t,n){Object(w.a)(this,e),this.gameView=void 0,this.gameController=void 0,this.gameView=t,this.gameController=n}return Object(y.a)(e,[{key:"initialState",value:function(){return{kind:"new_game"}}},{key:"start",value:function(e){return{kind:"in_game",game:this.gameController.newState()}}},{key:"tick",value:function(e){var t=this;return Object(O.a)(e,function(e){"in_game"===e.kind&&(e.game=t.gameController.tick(e.game))})}},{key:"input",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var n=this;return Object(O.a)(e,function(e){"in_game"===e.kind&&(e.game=n.gameController.input(e.game,t))})})}]),e}();function re(e){switch(e){case"ArrowLeft":return"LEFT";case"ArrowRight":return"RIGHT";case"ArrowDown":return"DOWN";case"ArrowUp":return"SPIN";case" ":return"DROP";default:return null}}function ae(e){return Math.floor(48*Math.pow(.9,e))}function ie(){return o.createElement("div",{id:"shape-tests"},o.createElement("h1",null,"Shape Tests"),G.map(function(e,t){return o.createElement("div",{className:"shape"},o.createElement($,{shapeIdx:t}))}))}var oe=function(){var e=document.getElementById("root");c.render(o.createElement(ie,null),e)};n(50);"/shape-test"===window.location.pathname?oe():function(){var e=new u.a,t=l.a(0,1e3/60).pipe(d.a(function(e){return{kind:"tick"}})),n=s.a(document,"keydown"),r=s.a(document,"keyup"),a=function(e){var t=e.pipe(K.a(function(e){return e.button}),d.a(function(e){return e.pipe(X.a("pressed"))}),Y.a()),n=Z.a(function(e){return"LEFT"===e.button||"RIGHT"===e.button||"DOWN"===e.button})(t),r=Object(g.a)(n,2),a=r[0],i=r[1],o={left:!1,right:!1,down:!1,action:"NONE"},c=a.pipe(p.a(function(e,t){return"DOWN"===t.button?Object(z.a)({},e,{down:t.pressed}):"LEFT"===t.button?t.pressed?Object(z.a)({},e,{left:!0,right:!1}):Object(z.a)({},e,{left:!1}):"RIGHT"===t.button?t.pressed?Object(z.a)({},e,{left:!1,right:!0}):Object(z.a)({},e,{right:!1}):e},o),v.a(o)),u=i.pipe(f.a(function(e){return e.pressed}),d.a(function(e){return e.button})),l=c.pipe(d.a(function(e){return Object(z.a)({},e,{action:"NONE"})})),s=u.pipe(ee.a(c),d.a(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return Object(z.a)({},r,{action:n})}));return h.a(l,s)}(h.a(r,n).pipe(d.a(function(e){return{button:re(e.key),pressed:"keydown"===e.type}}),f.a(function(e){return null!=e.button}))).pipe(d.a(function(e){return{kind:"input",input:e}})),m=h.a(e,a,t),b=Array.from({length:37},function(e,t){return{number:t+1,gravity:ae(t),multiplier:(n=ae(t),Math.abs(Math.floor(Math.log(n/48)/Math.log(.9)))+1)};var n}),w=new F(b),y=new _(new te(new i.a,2),w),O=new ne(w,y),k=O.initialState(),E=m.pipe(p.a(function(e,t){switch(t.kind){case"tick":return O.tick(e);case"input":return O.input(e,t.input);case"ui":return O.start(e)}},k),v.a(k)).pipe(d.a(function(t){return o.createElement(q,{key:"app",state:t,view:w,dispatch:function(t){return e.next(t)}})})),j=document.getElementById("root");E.subscribe(function(e){return c.render(e,j)})}(),function(){if("serviceWorker"in navigator){if(new URL("/v3",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/v3","/service-worker.js");r?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):a(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):a(e)})}}()}},[[41,1,2]]]);
//# sourceMappingURL=main.3c9b0cb1.chunk.js.map