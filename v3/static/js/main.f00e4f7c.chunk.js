(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{41:function(e,t,n){e.exports=n(51)},47:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function a(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var i=n(4),o=n(0),c=n(21),u=n(38),l=n(57),s=n(56),h=n(55),f=n(23),d=n(35),v=n(53),p=n(58);n(47);function m(e){switch(e.kind){case"empty":return"cell empty";case"shape":return"cell color-".concat(e.shapeIdx)}}var b=function(e){return o.createElement("div",{className:"Board"},e.cells.map(function(e,t){return o.createElement("div",{className:"row",key:t},e.map(function(e,t){return o.createElement("div",{className:m(e),key:t})}))}))},g=n(12),y=n(13),w=n(18),k=n(20);function E(e){return e.map(function(e){var t=Object(i.a)(e,2);return[t[0],-t[1]]})}var O=[[0,0],[1,0],[0,1],[0,2],[-1,1]],N=[[0,0],[0,1],[0,2],[0,3],[1,3]],j=[[1,0],[1,1],[0,1],[0,2],[0,3]],S=[[0,0],[1,0],[0,1],[1,1],[1,-1]],D=[[0,0],[0,1],[0,2],[0,3],[-1,1]],x=[[0,0],[0,1],[0,2],[-1,0],[1,2]],I=[O,E(O),N,E(N),j,E(j),S,E(S),D,E(D),x,E(x),[[0,-1],[0,1],[0,0],[1,0],[2,0]],[[0,0],[0,-1],[0,1],[-1,1],[-1,-1]],[[0,-2],[0,-1],[0,0],[1,0],[2,0]],[[0,0],[0,1],[1,1],[1,2],[2,2]],[[0,0],[-1,0],[1,0],[0,-1],[0,1]],[[0,0],[0,1],[0,2],[0,3],[0,4]]],T=[[0,0],[0,1],[0,2],[1,2]],L=E(T),M=[[1,0],[1,1],[0,1],[0,2]],A=E(M),C=[[[0,0]],[[0,0],[0,1]]].concat([[[0,0],[0,1],[0,2]],[[0,0],[0,1],[1,1]]],[[[0,0],[0,1],[0,2],[0,3]],T,L,[[0,0],[0,1],[1,0],[1,1]],M,A,[[0,0],[0,1],[0,2],[1,1]]],I),P=C.length;function R(e){var t=C[e.idx];return t=function(e,t){var n=function(e){var t=F(e),n=Object(i.a)(t,4),r=n[0],a=n[1],o=n[2],c=n[3]-a,u=Math.ceil((c-(o-r))/2);return[r-u+c/2,a+c/2]}(e),r=Object(i.a)(n,2),a=r[0],o=r[1],c=e;c=G(c,-a,-o);for(var u=0;u<t;u++)c=c.map(function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];return[r,-n]});return G(c,a,o)}(t,e.rot),t=G(t,e.row,e.col)}function W(e,t){var n=F(C[e]),r=Object(i.a)(n,4),a=r[1],o=r[2],c=r[3];return{idx:e,row:-o,col:Math.floor((t-c+a)/2)-a,rot:0}}function G(e,t,n){return e.map(function(e){var r=Object(i.a)(e,2),a=r[0],o=r[1];return[a+t,o+n]})}function F(e){var t=e.map(function(e){var t=Object(i.a)(e,2),n=t[0];t[1];return n}),n=e.map(function(e){var t=Object(i.a)(e,2);t[0];return t[1]});return[Math.min.apply(Math,Object(k.a)(t)),Math.min.apply(Math,Object(k.a)(n)),Math.max.apply(Math,Object(k.a)(t)),Math.max.apply(Math,Object(k.a)(n))]}var _=function(){function e(t){Object(g.a)(this,e),this.levelTable=void 0,this.levelTable=t}return Object(y.a)(e,[{key:"startingLevel",value:function(){return this.levelTable[0]}},{key:"getLevelInfo",value:function(e){var t=Math.floor(e.lines/10);return this.levelTable[t<this.levelTable.length?t:this.levelTable.length-1]}}]),e}(),B=function(){function e(t,n){Object(g.a)(this,e),this.rand=void 0,this.view=void 0,this.rand=t,this.view=n}return Object(y.a)(e,[{key:"newState",value:function(){return{width:12,height:24,nextShapeIdx:this.rand.nextShape(),activeShape:W(this.rand.nextShape(),12),dasDirection:"NONE",dasDelay:0,softDrop:!1,entryDelay:18,gravity:this.view.startingLevel().gravity,board:H(12,24),score:0,lines:0,toppedOut:!1}}},{key:"tick",value:function(e){var t=this;return e.toppedOut?e:Object(w.a)(e,function(e){t.doDAS(e),t.doEntry(e)&&(t.doGravity(e)||t.doLockDown(e))})}},{key:"input",value:function(e,t){var n=this;return e.toppedOut?e:Object(w.a)(e,function(e){switch(t.left?("NONE"===e.dasDirection&&(V(e,0,-1,0),e.dasDelay=16),e.dasDirection="LEFT"):t.right?("NONE"===e.dasDirection&&(V(e,0,1,0),e.dasDelay=16),e.dasDirection="RIGHT"):e.dasDirection="NONE",e.softDrop=t.down,t.action){case"NONE":break;case"SPIN":V(e,0,0,1);break;case"DROP":n.doDrop(e)}})}},{key:"doEntry",value:function(e){return!(0<e.entryDelay)||(e.entryDelay--,!1)}},{key:"doDAS",value:function(e){"NONE"!==e.dasDirection&&(0===e.dasDelay?(e.dasDelay=6,V(e,0,"LEFT"===e.dasDirection?-1:1,0)):e.dasDelay--)}},{key:"doGravity",value:function(e){return 0<e.gravity?(e.gravity-=e.softDrop?5:1,!0):(e.gravity=this.view.getLevelInfo(e).gravity,V(e,1,0,0))}},{key:"doDrop",value:function(e){for(;V(e,1,0,0););this.doLockDown(e)}},{key:"doLockDown",value:function(e){e.board=J(e),e.entryDelay=18,e.activeShape=W(e.nextShapeIdx,e.width),e.nextShapeIdx=this.rand.nextShape();for(var t=[],n=function(n){(function(){for(var t=0;t<e.width;t++)if("empty"===e.board[n][t].kind)return!1;return!0})()&&t.push(n)},r=0;r<e.height;r++)n(r);for(var a=H(e.width,e.height),i=e.height-1,o=e.height-1;i>=0;)if(t.includes(i))i--;else{for(var c=0;c<e.width;c++)a[o][c]=e.board[i][c];i--,o--}e.board=a,e.score+=this.view.getLevelInfo(e).multiplier*(Math.pow(2,t.length)-1),e.lines+=t.length,e.toppedOut=U(e,e.activeShape)}}]),e}();function H(e,t){for(var n=[],r=0;r<t;r++)n.push(Array(e).fill({kind:"empty"}));return n}function J(e){var t=e.board.map(function(e){return e.slice()}),n=!0,r=!1,a=void 0;try{for(var o,c=R(e.activeShape)[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var u=o.value,l=Object(i.a)(u,2),s=l[0],h=l[1];s<0||(t[s][h]={kind:"shape",shapeIdx:e.activeShape.idx})}}catch(f){r=!0,a=f}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}return t}function U(e,t){var n=!0,r=!1,a=void 0;try{for(var o,c=function(){var t=o.value,n=(l=Object(i.a)(t,2))[0],r=l[1];if(e.height<=n||r<0||e.width<=r||!(n<0)&&"empty"!==e.board[n][r].kind)return{v:!0}},u=R(t)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l,s=c();if("object"===typeof s)return s.v}}catch(h){r=!0,a=h}finally{try{n||null==u.return||u.return()}finally{if(r)throw a}}return!1}function V(e,t,n,r){var a={idx:e.activeShape.idx,row:e.activeShape.row+t,col:e.activeShape.col+n,rot:(e.activeShape.rot+r)%4};return!U(e,a)&&(e.activeShape=a,!0)}var Q=function(e){var t=e.shapeIdx,n=function(e){var t=C[e],n=F(t),r=Object(i.a)(n,4),a=r[0],o=r[1],c=r[2],u=r[3];return[G(t,-a,-o),c-a+1,u-o+1]}(t),r=Object(i.a)(n,3),a=r[0],c=r[1],u=r[2],l=Array.from({length:c},function(){return Array(u).fill({kind:"empty"})}),s=!0,h=!1,f=void 0;try{for(var d,v=a[Symbol.iterator]();!(s=(d=v.next()).done);s=!0){var p=d.value,m=Object(i.a)(p,2),g=m[0],y=m[1];l[g][y]={kind:"shape",shapeIdx:t}}}catch(w){h=!0,f=w}finally{try{s||null==v.return||v.return()}finally{if(h)throw f}}return o.createElement("div",{className:"PiecePreview"},o.createElement(b,{cells:l}))};n(49);var $=function(e){var t=e.state,n=e.view,r=e.dispatch;switch(t.kind){case"new_game":return o.createElement("div",{className:"App"},o.createElement("div",{className:"new-game"},o.createElement("h1",null,"Pentris!"),o.createElement("p",null,"v3beta: Now with Levels!!"),o.createElement("button",{className:"btn btn-primary",autoFocus:!0,onClick:function(){return r({kind:"ui",action:"START"})}},"New Game")));case"in_game":var a=t.game;return o.createElement("div",{className:"App"},o.createElement("main",null,o.createElement(b,{cells:J(a)})),o.createElement("aside",null,o.createElement("h1",null,"Pentris"),o.createElement("p",{className:"copy"},"It's Beta.",o.createElement("br",null),"It's Delicious.",o.createElement("br",null),"It's Pentris."),o.createElement("h2",null,"Preview"),o.createElement(Q,{shapeIdx:a.nextShapeIdx}),o.createElement("h3",null,"Score"),o.createElement("h3",null,"Lines Cleared"),o.createElement("p",{className:"score"},a.score),o.createElement("p",{className:"score"},a.lines),o.createElement("h3",null,"Level"),o.createElement("h3",null,"Speed"),o.createElement("p",{className:"score"},n.getLevelInfo(a).number),o.createElement("p",{className:"score"},n.getLevelInfo(a).multiplier)),o.createElement("div",{className:"game-over",hidden:!a.toppedOut},o.createElement("div",{className:"card"},o.createElement("h1",null,"OWNED!"),o.createElement("p",null,"Score: ",a.score),o.createElement("button",{className:"btn btn-primary",onClick:function(){return r({kind:"ui",action:"START"})}},"New Game"))))}},q=n(14),z=n(52),K=n(60),X=n(34),Y=n(59),Z=n(54);var ee=n(37),te=function(){function e(t,n){Object(g.a)(this,e),this.rand=void 0,this.n=void 0,this.bag=void 0,this.rand=t,this.n=n,this.bag=[]}return Object(y.a)(e,[{key:"nextShape",value:function(){return 0===this.bag.length&&(this.bag=Array.from({length:this.n*P},function(e,t){return t%P}),function(e,t){for(var n=e.length-1;n>0;n--){var r=Math.floor(t.next()*(n+1)),a=[e[r],e[n]];e[n]=a[0],e[r]=a[1]}}(this.bag,this.rand)),this.bag.pop()}}]),e}();function ne(e){return Math.floor(48*Math.pow(.9,e))}var re=function(){function e(t,n){Object(g.a)(this,e),this.gameView=void 0,this.gameController=void 0,this.gameView=t,this.gameController=n}return Object(y.a)(e,[{key:"initialState",value:function(){return{kind:"new_game"}}},{key:"start",value:function(e){return{kind:"in_game",game:this.gameController.newState()}}},{key:"tick",value:function(e){var t=this;return Object(w.a)(e,function(e){"in_game"===e.kind&&(e.game=t.gameController.tick(e.game))})}},{key:"input",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var n=this;return Object(w.a)(e,function(e){"in_game"===e.kind&&(e.game=n.gameController.input(e.game,t))})})}]),e}();function ae(e){switch(e){case"ArrowLeft":return"LEFT";case"ArrowRight":return"RIGHT";case"ArrowDown":return"DOWN";case"ArrowUp":return"SPIN";case" ":return"DROP";default:return null}}function ie(){return o.createElement("div",{id:"shape-tests"},o.createElement("h1",null,"Shape Tests"),Array.from({length:P},function(e,t){return o.createElement("div",{className:"shape"},o.createElement(Q,{shapeIdx:t}))}))}var oe=function(){var e=document.getElementById("root");c.render(o.createElement(ie,null),e)};n(50);"/shape-test"===window.location.pathname?oe():function(){var e=new u.a,t=l.a(0,1e3/60).pipe(f.a(function(e){return{kind:"tick"}})),n=s.a(document,"keydown"),r=s.a(document,"keyup"),a=function(e){var t=e.pipe(z.a(function(e){return e.button}),f.a(function(e){return e.pipe(K.a("pressed"))}),X.a()),n=Y.a(function(e){return"LEFT"===e.button||"RIGHT"===e.button||"DOWN"===e.button})(t),r=Object(i.a)(n,2),a=r[0],o=r[1],c={left:!1,right:!1,down:!1,action:"NONE"},u=a.pipe(v.a(function(e,t){return"DOWN"===t.button?Object(q.a)({},e,{down:t.pressed}):"LEFT"===t.button?t.pressed?Object(q.a)({},e,{left:!0,right:!1}):Object(q.a)({},e,{left:!1}):"RIGHT"===t.button?t.pressed?Object(q.a)({},e,{left:!1,right:!0}):Object(q.a)({},e,{right:!1}):e},c),p.a(c)),l=o.pipe(d.a(function(e){return e.pressed}),f.a(function(e){return e.button})),s=u.pipe(f.a(function(e){return Object(q.a)({},e,{action:"NONE"})})),m=l.pipe(Z.a(u),f.a(function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(q.a)({},r,{action:n})}));return h.a(s,m)}(h.a(r,n).pipe(f.a(function(e){return{button:ae(e.key),pressed:"keydown"===e.type}}),d.a(function(e){return null!=e.button}))).pipe(f.a(function(e){return{kind:"input",input:e}})),m=h.a(e,a,t),b=function(){var e=Array.from({length:37},function(e,t){return{number:t+1,gravity:ne(t),multiplier:(n=ne(t),Math.abs(Math.floor(Math.log(n/48)/Math.log(.9)))+1)};var n}),t=new _(e);return[t,new B(new te(new ee.a,2),t)]}(),g=Object(i.a)(b,2),y=g[0],w=g[1],k=new re(y,w),E=k.initialState(),O=m.pipe(v.a(function(e,t){switch(t.kind){case"tick":return k.tick(e);case"input":return k.input(e,t.input);case"ui":return k.start(e)}},E),p.a(E)).pipe(f.a(function(t){return o.createElement($,{key:"app",state:t,view:y,dispatch:function(t){return e.next(t)}})})),N=document.getElementById("root");O.subscribe(function(e){return c.render(e,N)})}(),function(){if("serviceWorker"in navigator){if(new URL("/v3",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/v3","/service-worker.js");r?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):a(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):a(e)})}}()}},[[41,1,2]]]);
//# sourceMappingURL=main.f00e4f7c.chunk.js.map