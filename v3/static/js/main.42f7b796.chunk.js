(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{38:function(e,t,n){e.exports=n(48)},44:function(e,t,n){},45:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(33),i=n(35),o=n(54),c=n(53),u=n(52),s=n(18),l=n(31),f=n(50),d=n(55);n(44),n(45);function p(e){switch(e.kind){case"empty":return"cell empty";case"shape":return"cell color-".concat(e.shapeIdx)}}var h=function(e){return r.createElement("div",{className:"Board"},e.cells.map(function(e,t){return r.createElement("div",{className:"row",key:t},e.map(function(e,t){return r.createElement("div",{className:p(e),key:t})}))}))},v=n(4),w=n(16);function m(e){return e.map(function(e){var t=Object(v.a)(e,2);return[t[0],-t[1]]})}function y(e){var t=e.map(function(e){var t=Object(v.a)(e,2),n=t[0];t[1];return n}),n=e.map(function(e){var t=Object(v.a)(e,2);t[0];return t[1]});return[Math.min.apply(Math,Object(w.a)(t)),Math.min.apply(Math,Object(w.a)(n)),Math.max.apply(Math,Object(w.a)(t)),Math.max.apply(Math,Object(w.a)(n))]}var b=[[0,0],[1,0],[0,1],[0,2],[-1,1]],g=[[0,0],[0,1],[0,2],[0,3],[1,3]],O=[[1,0],[1,1],[0,1],[0,2],[0,3]],N=[[0,0],[1,0],[0,1],[1,1],[1,-1]],E=[[0,0],[0,1],[0,2],[0,3],[-1,1]],k=[[0,0],[0,1],[0,2],[-1,0],[1,2]],x=[b,[[0,0],[0,1],[0,2],[0,3],[0,4]],O,N,[[0,-1],[0,1],[0,0],[1,0],[2,0]],[[0,0],[0,-1],[0,1],[-1,1],[-1,-1]],[[0,-2],[0,-1],[0,0],[1,0],[2,0]],[[0,0],[0,1],[1,1],[1,2],[2,2]],[[0,0],[-1,0],[1,0],[0,-1],[0,1]],E,k,m(b),m(g),m(O),m(N),m(E),m(k),g],I=[[0,0],[0,1],[0,2],[1,2]],j=m(I),S=[[1,0],[1,1],[0,1],[0,2]],D=m(S),R=[[[0,0]],[[0,0],[0,1]]].concat([[[0,0],[0,1],[0,2]],[[0,0],[0,1],[1,1]]],[[[0,0],[0,1],[0,2],[0,3]],I,j,[[0,0],[0,1],[1,0],[1,1]],S,D,[[0,0],[0,1],[0,2],[1,1]]],x).map(function(e){var t=function(e){var t=y(e),n=Object(v.a)(t,4),r=n[0],a=n[1],i=n[2],o=n[3];return[Math.floor((r+i)/2),Math.floor((a+o)/2)]}(e),n=Object(v.a)(t,2),r=n[0],a=n[1];return e.map(function(e){var t=Object(v.a)(e,2),n=t[0],i=t[1];return[n-r,i-a]})});var A=function(e){var t=e.shapeIdx,n=function(e){var t=y(e),n=Object(v.a)(t,4),r=n[0],a=n[1],i=n[2],o=n[3];return[e.map(function(e){var t=Object(v.a)(e,2),n=t[0],i=t[1];return[n-r,i-a]}),i-r+1,o-a+1]}(R[t]),a=Object(v.a)(n,3),i=a[0],o=a[1],c=a[2],u=Array.from({length:o},function(){return Array(c).fill({kind:"empty"})}),s=!0,l=!1,f=void 0;try{for(var d,p=i[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){var w=d.value,m=Object(v.a)(w,2),b=m[0],g=m[1];u[b][g]={kind:"shape",shapeIdx:t}}}catch(O){l=!0,f=O}finally{try{s||null==p.return||p.return()}finally{if(l)throw f}}return r.createElement("div",{className:"PiecePreview"},r.createElement(h,{cells:u}))},P=n(30),M=16,T=6,C=18,W=30;function L(e,t){for(var n=[],r=0;r<t;r++)n.push(Array(e).fill({kind:"empty"}));return n}function H(e){for(var t=R[e.shapeIdx],n=0;n<e.rotation;n++)t=t.map(function(e){var t=Object(v.a)(e,2),n=t[0];return[t[1],-n]});return(t=t.map(function(t){var n=Object(v.a)(t,2),r=n[0],a=n[1];return[r+e.dRow,a+e.dCol]})).filter(function(e){var t=Object(v.a)(e,2),n=t[0];t[1];return n>=0})}function F(e){var t=e.board.map(function(e){return e.slice()}),n=H(e.activeShape),r=!0,a=!1,i=void 0;try{for(var o,c=n[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value,s=Object(v.a)(u,2),l=s[0],f=s[1];t[l][f]={kind:"shape",shapeIdx:e.activeShape.shapeIdx}}}catch(d){a=!0,i=d}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return t}function G(e){return e.nextInt(0,R.length-1)}function B(e,t,n,r){var a={shapeIdx:e.activeShape.shapeIdx,dRow:e.activeShape.dRow+t,dCol:e.activeShape.dCol+n,rotation:(e.activeShape.rotation+r)%4};return!function(e,t){var n=H(t),r=!0,a=!1,i=void 0;try{for(var o,c=function(){var t=o.value,n=(s=Object(v.a)(t,2))[0],r=s[1];if(e.height<=n||r<0||e.width<=r||!(n<0)&&"empty"!==e.board[n][r].kind)return{v:!0}},u=n[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s,l=c();if("object"===typeof l)return l.v}}catch(f){a=!0,i=f}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return!1}(e,a)&&(e.activeShape=a,!0)}function J(e,t){switch(t){case"LEFT":return B(e,0,-1,0);case"DOWN":return B(e,1,0,0);case"RIGHT":return B(e,0,1,0);case"SPIN":return B(e,0,0,1)}}function U(e,t){return Object(P.a)(t,function(t){(function(e){return!(0<e.entryDelay)||(e.entryDelay--,!1)})(t)&&(function(e){"NONE"!==e.dasDirection&&(0===e.dasDelay?(e.dasDelay=T,J(e,e.dasDirection)):e.dasDelay--)}(t),function(e,t){0===t.gravity?(t.gravity=W,B(t,1,0,0)||(t.board=F(t),t.entryDelay=C,t.activeShape={shapeIdx:t.nextShapeIdx,dRow:0,dCol:t.width/2,rotation:0},t.nextShapeIdx=G(e))):t.gravity--}(e,t),function(e){for(var t=[],n=function(n){(function(){for(var t=0;t<e.width;t++)if("empty"===e.board[n][t].kind)return!1;return!0})()&&t.push(n)},r=0;r<e.height;r++)n(r);for(var a=L(e.width,e.height),i=e.height-1,o=e.height-1;i>=0;)if(t.includes(i))i--;else{for(var c=0;c<e.width;c++)a[o][c]=e.board[i][c];i--,o--}e.board=a,e.score+=Math.pow(2,t.length)-1,e.lines+=t.length}(t))})}function Q(e,t){return Object(P.a)(e,function(e){switch(t.input.direction){case"NONE":e.dasDirection="NONE";break;case"LEFT":case"RIGHT":case"DOWN":"NONE"===e.dasDirection&&(e.dasDelay=M,J(e,t.input.direction)),e.dasDirection=t.input.direction}switch(t.input.action){case"NONE":break;case"SPIN":J(e,t.input.action);break;case"DROP":!function(e){for(;B(e,1,0,0););}(e)}})}var $=function(e){var t=e.state;return r.createElement("div",{className:"App"},r.createElement(h,{cells:F(t)}),r.createElement("aside",null,r.createElement("h1",null,"Pentris"),r.createElement("p",null,"It's Alpha. It's Delicious. It's Pentris."),r.createElement("h2",null,"Preview"),r.createElement(A,{shapeIdx:e.state.nextShapeIdx}),r.createElement("h2",null,"Score"),r.createElement("p",{className:"score"},t.score),r.createElement("h2",null,"Lines Cleared"),r.createElement("p",{className:"score"},t.lines)))},q=n(49),z=n(57),K=n(29),V=n(56),X=n(51);n(47);var Y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Z(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var _=n(34),ee=new i.a,te=o.a(0,1e3/60).pipe(s.a(function(e){return{kind:"tick"}})),ne=c.a(document,"keydown"),re=c.a(document,"keyup");function ae(e){switch(e){case"ArrowLeft":return"LEFT";case"ArrowRight":return"RIGHT";case"ArrowDown":return"DOWN";case"ArrowUp":return"SPIN";case" ":return"DROP";default:return null}}var ie,oe=function(e){var t=e.pipe(q.a(function(e){return e.button}),s.a(function(e){return e.pipe(z.a("pressed"))}),K.a()),n=V.a(function(e){return"LEFT"===e.button||"RIGHT"===e.button||"DOWN"===e.button})(t),r=Object(v.a)(n,2),a=r[0],i=r[1],o=a.pipe(f.a(function(e,t){var n=t.button;return t.pressed?n:e===t.button?"NONE":e},"NONE"),d.a("NONE")),c=i.pipe(l.a(function(e){return e.pressed}),s.a(function(e){return e.button})),p=o.pipe(s.a(function(e){return{direction:e,action:"NONE"}})),h=c.pipe(X.a(o),s.a(function(e){var t=Object(v.a)(e,2),n=t[0];return{direction:t[1],action:n}}));return u.a(p,h)}(u.a(re,ne).pipe(s.a(function(e){return{button:ae(e.key),pressed:"keydown"===e.type}}),l.a(function(e){return null!=e.button}))).pipe(s.a(function(e){return{kind:"input",input:e}})),ce=u.a(ee,oe,te),ue=new _.a,se={width:12,height:24,nextShapeIdx:G(ie=ue),activeShape:{shapeIdx:G(ie),dRow:0,dCol:6,rotation:0},dasDirection:"NONE",dasDelay:0,entryDelay:C,gravity:W,board:L(12,24),score:0,lines:0},le=ce.pipe(f.a(function(e,t){return function(e,t,n){switch(n.kind){case"tick":return U(e,t);case"input":return Q(t,n)}}(ue,e,t)},se),d.a(se)).pipe(s.a(function(e){return r.createElement($,{key:"app",state:e})})),fe=document.getElementById("root");le.subscribe(function(e){return a.render(e,fe)}),window.SHAPES=R,window.DISPATCH=function(e){return ee.next(e)},function(){if("serviceWorker"in navigator){if(new URL("/v3",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/v3","/service-worker.js");Y?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Z(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Z(e)})}}()}},[[38,1,2]]]);
//# sourceMappingURL=main.42f7b796.chunk.js.map